# Building Themes for Ext JS

There are several steps required to build a Theme that Sencha Command automates for you. In
the future, Sencha Command will take on even more of the process.

{@img ../command/sencha-command-128.png}

## Requirements

In order to build themes from SASS, you will need:

 * [Compass](http://compass-style.org/)

## Disclaimer

This guide is focused on the file-level mechanics of building and managing themes. It does
not describe how to develop themes, manage styles or SASS variables.

## Getting Started

Most of this guide assumes you are working in an application generated by Sencha Command.
If that is not the case, many of these steps will change to reflect different paths and the
like. See the section below on "Managing Themes Manually".

All applications start with a "default" theme. Different pieces are stored in two folders:

 * `./resources/sass/default`
 * `./resources/theme/default`

### Use of SASS

The majority of your work on themes is done in SASS. The starter files are generated for
you, but then you proceed to edit them.

When you compile your SASS, it should generate a CSS file in "./resources/css/default"
named "theme.css".

## Multiple Themes

If you need two or more themes (as described in [Developing Apps with Sencha Command](#/guide/command_app))
you can generate new themes with this command:

    sencha generate theme foo

This will generate:

 * `./resources/sass/foo`
 * `./resources/theme/foo`

And the SASS for this theme should be compiled to "./resources/css/foo/theme.css".

## Compiling Your Themes

Typically, your themes will be compiled and built by the `sencha app build` command, but
it is sometimes helpful to build a single theme at a time.

To compile a theme, you must currently use the `compass compile` command in your SASS
directory. TODO - sencha theme compile default ?

    cd /path/to/MyApp/resources/sass/default
    compass compile

This should produce the CSS in "../../css/default/theme.css" (or from the root of your
application folder, "resources/css/default/theme.css").

The next step is to build the image slices needed for IE browsers. This is done like so:

    cd /path/to/MyApp
    sencha theme build default

This will place the sliced images in the "./resources/css/default" folder alongside the
CSS file generated by SASS. This approach reduces the size of the CSS file since all image
paths are relative to the CSS file location.

## Anatomy of a Theme

The `theme` folder is split in to two levels. For clarity, lets consider a `theme` folder
with two themes:

    theme/
        custom.js
        manifest.js
        render.js
        shortcuts.js
        default/
            theme.html
        gray/
            theme.html

### theme.html

The `theme.html` file is the entry point for the image generation phase of the theme
builder.

You should be able to open this file in Chrome (or other modern browser) and see what the
base image will be for your theme. This is an ideal page to test your styling, of course,
because every component in every state will be present.

This is an example of what the "resources/theme/default/theme.html" file looks like:

    <html>
        <head>
            <title></title>
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

            <link rel="stylesheet" type="text/css" href="../../css/default/theme.css" />
            <link rel="stylesheet" type="text/css" href="../styles.css" />

            <script type="text/javascript" src="../../../sdk/ext-all.js"></script>
            <script type="text/javascript" src="../manifest.js"></script>
            <script type="text/javascript" src="../shortcuts.js"></script>
            <script type="text/javascript" src="../custom.js"></script>
            <script type="text/javascript" src="../render.js"></script>
        </head>
        <body class="ext-generator">
        </body>
    </html>

This file is designed to be edited as needed. This file will not be edited or regenerated
by Sencha Command.

**IMPORTANT:** While this file is "freely" editable, be sure to keep the relative order of
the `link` and `script` tags. In particular `custom.js` must come after `manifest.js` and
`shortcuts.js` and before `render.js`.

The most likely things you might need to edit in this file are the relative paths. All of
the generated files included in the page need to be preserved. You can add `script` tags
or `link` tags as needed, but consider their order in the sequence of tags.

### Private Files

There are several files that should be considered "private" and should not be edited. These
are 

 * `manifest.js` - TODO
 * `shortcuts.js` - TODO
 * `styles.css` - This file contains styles specific to the theme builder.
 * `render.js` - This file renders the components described by the manifest and shortcuts.

### Customization

The `custom.js` file is the file where you can add value to the process. This file will
not be regenerated by Sencha Command. The primary use of this file is to add new shortcuts
or manifest entries that might be needed by custom components you have created for your
application.

To add manifest entires ... TODO

To add shortcuts ... TODO

### Third Party Components

If you have received custom components from a third party, you should ask them to provide
a custom theme definition file so that you can include it in your `theme` folder and as a
`script` tag in your 'theme.html'. The content of such a file should be the same as
described for a `custom.js` file.

You will probably also need SASS files (or at least CSS files) to add to your SASS theme
and/or as `link` tags in `theme.html`.

## Managing Themes Manually

Many applications existed before Sencha Command provided application management features or
for other reasons do not have the structure assumed by the "simple" commands described
above. While the commands to handle this case require more switches and understanding, it
is possible to use Sencha Command in these more complex situations.

**IMPORTANT:** The new version of Sencha Command takes a different approach to theme
building than did previous versions (which called this mechanism "The Slicer"). There is
no longer a `sencha slice` command. This is now handled by the new `sencha theme build`
command.

### Creating Your Custom Theme

In order to produce sliced images for your theme, you need the necessary files that define
the theme. The easiest way to get these files is to generate an application in some temporary
folder and copy the ./resources/theme folder to a location of your choosing.

    sencha generate app /temp/dummyApp

Then copy "/temp/dummApp/resources/theme" to your desired location. For example, let's say
that location is "/path/to/MyApp/stuff/theme".

Following the above rules for customization of `theme.html` you can flatten the folders in
to a single folder and change the relative paths in `theme.html` accordingly. You can also
correct the relative paths to your CSS file(s) and the framework.

## Compiling Your Custom Theme

Once you have moved the theme files to "/path/to/MyApp/stuff/theme" and editing all of the
relative paths in `theme.html`, you can proceed to generate images. Let's assume you run
the command from the root of your application.

    cd /path/to/MyApp
    sencha theme build -page stuff/theme/theme.html -out images/theme

This will load "stuff/theme/theme.html" using an embedded WebKit instance and capture an
image of the content of the rendered page as well as a data object describing all of the
image slicing required. From those two results, the image slicing will proceed to generate
all of the images to the "images/theme" folder.

If something is wrong with the generated images, it can be helpful to keep the page image
and the data object for diagnostic purposes. This can be done by specifying their names in
the command:

    cd /path/to/MyApp
    sencha theme build -page stuff/theme/theme.html -out images/theme \
        -image image.png -data data.json

The image is always a PNG file because PNG is both lossless and has a proper alpha channel.
The data object is always in JSON format.
